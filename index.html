<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Baked.js by prismicio</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Baked.js</h1>
        <p class="header">A static website generator in JS, powerered by prismic.io</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/prismicio/baked.js/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/prismicio/baked.js/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/prismicio/baked.js">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/prismicio">prismicio</a></p>


      </header>
      <section>
        <h1>
<a name="bakedjs" class="anchor" href="#bakedjs"><span class="octicon octicon-link"></span></a>baked.js</h1>

<p>baked.js is a static website generator based on <a href="https://prismic.io">prismic.io</a>.</p>

<h2>
<a name="install" class="anchor" href="#install"><span class="octicon octicon-link"></span></a>Install</h2>

<div class="highlight highlight-sh"><pre>npm install -g baked
</pre></div>

<h2>
<a name="use" class="anchor" href="#use"><span class="octicon octicon-link"></span></a>Use</h2>

<h3>
<a name="simple-generation" class="anchor" href="#simple-generation"><span class="octicon octicon-link"></span></a>Simple generation</h3>

<p>Run the command:</p>

<div class="highlight highlight-sh"><pre>baked
</pre></div>

<p>It will generate all files from the current directory into the <code>generated/</code> directory.</p>

<p>You can set some options using command line arguments:</p>

<ul>
<li>
<code>--no-async</code>: Generate files one by one (slower but easier to debug)</li>
<li>
<code>--src &lt;src_dir&gt;</code>: Specify the source directory</li>
<li>
<code>--dst &lt;dst_dir&gt;</code>: Specify the directory where generated files will be stored</li>
<li>
<code>--ignore &lt;pattern&gt;</code>: Ignore a file/directory (can be use multiple times)</li>
</ul>

<h3>
<a name="custom-generation" class="anchor" href="#custom-generation"><span class="octicon octicon-link"></span></a>Custom generation</h3>

<p>You can specify your own gulpfile.js and use the tasks you defined.</p>

<p>Have a look on the examples to see how you can achieve this.</p>

<h2>
<a name="local-server" class="anchor" href="#local-server"><span class="octicon octicon-link"></span></a>Local server</h2>

<p>Run the command:</p>

<div class="highlight highlight-sh"><pre>gulp serve
</pre></div>

<p>This task:</p>

<ul>
<li>generates the content (as “<code>gulp</code>” does)</li>
<li>starts an HTTP server which serves the generated files</li>
<li>watches modification on your sources (and the baked.js sources) and re-generate on every changes</li>
</ul>

<p>Go to <a href="http://127.0.0.1:8282">http://127.0.0.1:8282</a> using your favorite browser and you will see the result.</p>

<h2>
<a name="try-on-the-examples" class="anchor" href="#try-on-the-examples"><span class="octicon octicon-link"></span></a>Try on the examples</h2>

<p>Some examples of sources directory is available in the <code>examples/</code> directory.</p>

<ul>
<li>the <code>blank</code> example presents a blank project based on baked.js</li>
<li>the <code>stylus</code> example presents a project based on baked.js and using Stylus

<ul>
<li>to test it, install its dependencies (<code>npm install</code>) then run <code>gulp</code>
</li>
</ul>
</li>
<li>the <code>vanilla</code> example presents a project containing only sources

<ul>
<li>to test it, install baked (<code>npm install -g baked</code>) then run <code>baked</code>
</li>
</ul>
</li>
</ul>

<h2>
<a name="template" class="anchor" href="#template"><span class="octicon octicon-link"></span></a>Template</h2>

<p>Lodash's template can be used, with syntax “<code>[% %]</code>” (and “<code>[%= %]</code>”, “<code>[%- %]</code>”).</p>

<p>Here are the variables passed to the template:</p>

<ul>
<li>
<code>_</code>: Lodash</li>
<li>
<code>api</code>: The main API object</li>
<li>
<code>bookmarks</code>: The bookmarks list</li>
<li>
<code>ref</code>: The current ref</li>
<li>
<code>refs</code>: The refs list</li>
<li>
<code>types</code>: The types list</li>
<li>
<code>tags</code>: The tags list</li>
<li>
<code>master</code>: The master ref</li>
</ul>

<div class="highlight highlight-html"><pre>[% _.each(tags, function (tag) { %]
  <span class="nt">&lt;span&gt;</span>[%= tag %]<span class="nt">&lt;/span&gt;</span>
[% }) %]
</pre></div>

<h2>
<a name="queries" class="anchor" href="#queries"><span class="octicon octicon-link"></span></a>Queries</h2>

<p>Queries (to prismic.io repositories) can be written directly in the template, using specify <code>&lt;script&gt;</code> tags (with <code>type="text/prismic-query"</code>).</p>

<p>The documents returned by the queries are passed to the templated through the variable whose name is specified with <code>data-binding</code> attribute.</p>

<p>Pagination related parameters can be specified using <code>data-query-&lt;name&gt;</code> syntax.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/prismic-query"</span> <span class="na">data-binding=</span><span class="s">"product"</span> <span class="na">data-query-orderings=</span><span class="s">"[my.product.name]"</span><span class="nt">&gt;</span>
  <span class="p">[</span>
    <span class="p">[</span><span class="o">:</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">any</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="p">[</span><span class="s2">"product"</span><span class="p">])]</span>
    <span class="p">[</span><span class="o">:</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">at</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">[</span><span class="s2">"Featured"</span><span class="p">])]</span>
  <span class="p">]</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;h1&gt;</span>[%= featuredProducts.total_results_size %] featured products:<span class="nt">&lt;/h1&gt;</span>
[% _.each(featuredProducts, function(product) { %]
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;h2&gt;</span>[%= product.getText('product.name') %]<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"[%= product.getImageView('product.image', 'icon').url %]"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
[% }) %]
</pre></div>

<h2>
<a name="links" class="anchor" href="#links"><span class="octicon octicon-link"></span></a>Links</h2>

<p>To create links to an other generated page, use the helper <code>url_to</code>, and specify the file name (without the “.html” part).</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"[%= url_to('search') %]"</span><span class="nt">&gt;</span>[%= product.getText('product.name') %]<span class="nt">&lt;/a&gt;</span>
</pre></div>

<h2>
<a name="page-parameters" class="anchor" href="#page-parameters"><span class="octicon octicon-link"></span></a>Page parameters</h2>

<p>Some pages (like articles of a blog) can have dynamically generated URL. This can be done by creating one file and specify parameter, like the ID of the article.</p>

<p>The problem is that these parameters are generally not known before parsing other pages linking to them. For instance the main blog page lists some articles (displaying previews) and gives links to the full article pages. That's how we know that there are articles of these specific IDs.</p>

<p>In baked.js, we use linking pages to infer that there are articles to be generated with these specific IDs. In short, we need to know that a page is needed in order to be able to create it!</p>

<p>First, add a <code>&lt;meta&gt;</code> tag per parameter in the page's header.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"prismic-routing-param"</span> <span class="na">content=</span><span class="s">"id"</span><span class="nt">&gt;</span>
</pre></div>

<p>Then use these parameters in your query, by using the syntax <code>$name</code> or <code>${name}.</code></p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/prismic-query"</span> <span class="na">data-binding=</span><span class="s">"product"</span><span class="nt">&gt;</span>
  <span class="p">[</span>
    <span class="p">[</span><span class="o">:</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">any</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">[</span><span class="s2">"$id"</span><span class="p">])]</span>
  <span class="p">]</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p>To create links to the above page, use the helper <code>url_to</code>, and specify the arguments.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"[%= url_to('product', {id: product.id}) %]"</span><span class="nt">&gt;</span>
    [%= product.getText('product.name') %]
<span class="nt">&lt;/a&gt;</span>
</pre></div>

<p><strong>Bonus</strong>: if your only argument is “<code>id</code>”, you can give it directly, without wraping it in a “<code>{id: "xxx"}</code>” structure.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"[%= url_to('product', product.id) %]"</span><span class="nt">&gt;</span>
    [%= product.getText('product.name') %]
<span class="nt">&lt;/a&gt;</span>
</pre></div>

<p>You can also use the helper without providing any argument.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"[%= url_to('index') %]"</span><span class="nt">&gt;</span>index<span class="nt">&lt;/a&gt;</span>
</pre></div>

<p><strong>Note</strong>: remember: if nobody call a page (using the <code>url_to</code> helper) it won't be generated.</p>

<h3>
<a name="custom-url" class="anchor" href="#custom-url"><span class="octicon octicon-link"></span></a>Custom URL</h3>

<p>It is possible to customize the URL as well. To do so, just add a <code>&lt;meta&gt;</code> tag “<code>prismic-routing-pattern</code>” in your page's header.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"prismic-routing-pattern"</span> <span class="na">content=</span><span class="s">"product/$id"</span><span class="nt">&gt;</span>
</pre></div>

<p><strong>Warning</strong>: be sure to specify every routing params in the URL! If you don't, we can't guarantee that there won't be URL conflict.</p>

<h2>
<a name="internals" class="anchor" href="#internals"><span class="octicon octicon-link"></span></a>Internals</h2>

<p>baked.js is built on top of <a href="nodejs.org">Node.js</a>.</p>

<p>It uses <a href="https://github.com/kriskowal/q">Q</a> and <a href="http://lodash.com">lodash</a>,
let <a href="gulpjs.com">Gulp</a> and <a href="browserify.org">browserify</a> handle the generation
of the browser library and uses <a href="https://github.com/visionmedia/ejs">EJS</a> for
the template rendering.</p>

<h3>
<a name="dynamic-browser-mode" class="anchor" href="#dynamic-browser-mode"><span class="octicon octicon-link"></span></a>Dynamic browser mode</h3>

<p>The generation can actually be performed at 2 places:</p>

<ul>
<li>Statically by the gulp task

<ul>
<li>This is the standard mode.</li>
<li>It allows to send proper content the browsers and search engines.</li>
</ul>
</li>
<li>Dynamically by the browser

<ul>
<li>Every statically rendered page is able to re-generate itself, and then to emulate the navigation in the others pages (using <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/history.html#the-history-interface">HTML5's History API</a>).</li>
<li>It allows to specify specific <code>access_token</code> and <code>ref</code>, in order to render the content using a specific prismic.io's release. These can be set automatically using the <a href="#auth2-authentication">OAuth2 authentication</a>.</li>
</ul>
</li>
</ul>

<p>The dynamic mode needs some specific components:</p>

<ul>
<li>The baked.js library (for instance <code>&lt;script src="https://prismicio.github.io/baked.js/baked-0.2.1.min.js"&gt;&lt;/script&gt;</code>)</li>
<li>The template of every content file (stored in the <code>.html.tmpl</code> files)

<ul>
<li>These files allow to render any page</li>
</ul>
</li>
<li>The routing informations of every content pages (stored in <code>_router.json</code>

<ul>
<li>This file allows to build a router which is used to

<ul>
<li>create a link between the current page and the ones references by the <code>url_to</code> helper (reverse routing)</li>
<li>find the template to use, its parameters and the given argument in case of non-statically-rendered page (routing)

<ul>
<li>This case can happen when loading a page that is created only with a specific release.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

<h4>
<a name="specific-ref-to-use" class="anchor" href="#specific-ref-to-use"><span class="octicon octicon-link"></span></a>Specific ref to use</h4>

<p>baked.js provides a helper to easilly switch between refs.</p>

<p>It listen changes made on elements containing the attribute
“<code>data-prismic-action="update"</code>” and update the ref (and re-generate)
accordingly.</p>

<p>Here an example of use:</p>

<pre lang="ejs"><code>&lt;select data-prismic-action="update"&gt;
  [% _.each(refs, function (r) { %]
    [% if (r.ref == ref) { %]
      &lt;option value="[%= r.ref %]" selected="selected"&gt;[%= r.label %]&lt;/option&gt;
    [% } else { %]
      &lt;option value="[%= r.ref %]"&gt;[%= r.label %]&lt;/option&gt;
    [% } %]
  [% }) %]
&lt;/select&gt;
</code></pre>

<h4>
<a name="oauth2-authentication" class="anchor" href="#oauth2-authentication"><span class="octicon octicon-link"></span></a>OAuth2 authentication</h4>

<p>baked.js provides a helper to authenticate to your prismic.io application
using OAuth2.</p>

<p>It listen the “click” events on elements containing attributes
“<code>data-prismic-action="signout"</code>” or “<code>data-prismic-action="signin"</code>.”</p>

<p>In order to work, this feature needs a meta tag “<code>prismic-oauth-client-id</code>”
to be defined.</p>

<p>Here an example:</p>

<pre lang="ejs"><code>&lt;meta name="prismic-oauth-client-id" content="YOUR_CLIENT_ID"&gt;
...
[% if (loggedIn) { %]
  &lt;select data-prismic-action="update"&gt;
    [% _.each(refs, function (r) { %]
      [% if (r.ref == ref) { %]
        &lt;option value="[%= r.ref %]" selected="selected"&gt;[%= r.label %]&lt;/option&gt;
      [% } else { %]
        &lt;option value="[%= r.ref %]"&gt;[%= r.label %]&lt;/option&gt;
      [% } %]
    [% }) %]
  &lt;/select&gt;
  &lt;button data-prismic-action="signout"&gt;Sign out&lt;/button&gt;
[% } else { %]
  &lt;button data-prismic-action="signin"&gt;Sign in&lt;/button&gt;
[% } %]
</code></pre>

<h3>
<a name="licence" class="anchor" href="#licence"><span class="octicon octicon-link"></span></a>Licence</h3>

<p>This software is licensed under the Apache 2 license, quoted below.</p>

<p>Copyright 2013 Zengularity (<a href="http://www.zengularity.com">http://www.zengularity.com</a>).</p>

<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this project except in compliance with the License. You may obtain a copy of the License at <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>.</p>

<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->



</body>
</html>
